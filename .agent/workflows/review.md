---
description: 3視点レビュー（UXチェック / 設計改善ループ / UI向上）を実行する
---

# /review — 3視点レビューワークフロー

## 概要
コードの変更やマイルストーン到達時に、**3つの専門視点**で自動レビューを行い、品質を担保する仕組み。

## 前提
- 対象ファイル群が特定できていること（変更ファイルまたは対象コンポーネント）
- アプリがローカルで起動可能な状態（APIテスト用）

---

## ステップ

### 1. 対象ファイルの特定
- 変更されたファイル、またはレビュー対象のコンポーネントを `view_file` / `view_file_outline` で読み込む
- フロントエンド（HTML/CSS/JS）とバックエンド（server.js/API）を区別

### 2. 📱 UXチェック役

**観点**: ユーザーが迷わず・安心して使えるか

チェック項目：
- [ ] **フロー完走**: ヒーロー画面 → チャット → 生成 → 結果 → PDF出力まで途切れないか
- [ ] **分岐の整合性**: 選択肢によってAIメッセージの文脈がズレないか（条件分岐の網羅性）
- [ ] **戻り操作**: 「戻る」機能が安全か（DOM残骸・状態矛盾がないか）
- [ ] **エラーハンドリング**: API失敗時にユーザーが詰まらないか（フォールバックパスの確認）
- [ ] **情報量の適切さ**: 各ステップのメッセージ量が多すぎ/少なすぎないか
- [ ] **安全表示**: 個人情報注意・たたき台注意が常時視認できるか
- [ ] **所要時間の提示**: ユーザーが「あとどれくらい？」を把握できるか
- [ ] **🆕 デリバー原則**: 生成物が言及する成果物（実績シート・協賛メニュー等）のたたき台が同時に提供されているか。「作ってください」で止めない。地方現場の利用者は基本情報の言語化ができていないケースが多い

出力形式：
```
| # | 重要度 | 箇所 | 問題 | 改善案 |
```

### 3. 🔧 設計改善ループ役

**観点**: コードの持続性・安全性・拡張性

チェック項目：
- [ ] **関心の分離**: ビジネスロジックがUI層に漏れていないか
- [ ] **セキュリティ**: XSS/インジェクションリスク（innerHTML直接操作、ユーザー入力の無検証等）
- [ ] **グローバル状態**: window汚染やグローバル変数の不適切な使用がないか
- [ ] **API設計**: エラー応答とフォールバックが適切か（success: true でエラーを返さない等）
- [ ] **パフォーマンス**: 不要な再読み込み・再計算がないか（プロンプトの毎回読み込み等）
- [ ] **依存関係**: 未使用のdependencyがないか、CDNの可用性リスクはないか
- [ ] **テスタビリティ**: 関数が副作用なくテスト可能か
- [ ] **🆕 発信基盤サポート**: プロンプトが「作ってください」ではなく「たたき台を生成」しているか。モックデータが言及する成果物（実績シート・協賛メニュー・報告書等）のテンプレートが出力に含まれるか

出力形式：
```
| # | 重要度 | 箇所 | 問題 | 改善案 |
```

### 4. 🎨 UI向上役

**観点**: 見た目の品質・レスポンシブ・微細なインタラクション

チェック項目：
- [ ] **レイアウト制御**: ビューポートに収まっているか（無限スクロール・溢れの確認）
- [ ] **色彩の統一**: CSS変数に集約されているか、ハードコード色がないか
- [ ] **タイポグラフィ**: フォントサイズの階層（h1 > h2 > body > caption）が適切か
- [ ] **アニメーション**: 存在するが邪魔でないか、`prefers-reduced-motion` は考慮されているか
- [ ] **レスポンシブ**: 640px以下での表示崩れがないか
- [ ] **ホバー/アクティブ**: タッチデバイスで意味のないホバーが含まれていないか
- [ ] **印刷/PDF**: PDF出力時のスタイルが崩れていないか
- [ ] **ブランド感**: ローディング・空状態がブランドトーンに合っているか

出力形式：
```
| # | 重要度 | 箇所 | 問題 | 改善案 |
```

### 5. 🎯 行動変容審査役（Behavior Change Auditor）

**観点**: 読むだけで受け取った人が「次の行動」を起こすか

**原則**: 生成物の読み手はユーザーだけではない。各出力には想定読者がいる。
その人が**読了後15分以内に最初のアクションを起こせる**レベルかを審査する。

#### 想定読者マッピング
| 出力 | 想定読者 | 期待するアクション |
|------|---------|-------------------|
| 90日プラン | ユーザー本人 | Week1の最初のタスクに着手 |
| 資金計画 | ユーザー本人 | 協賛候補リストの作成を開始 |
| 自治体メール | 市町村の担当者 | 返信する / 面談日を提案する |
| 企業メール | 企業のCSR担当 | 社内回覧する / 詳細を求める |
| SNS投稿 | 地域住民 | シェアする / 寄付リンクを踏む |
| テンプレート集 | ユーザー本人 | 内容を確認して印刷/提出する |

#### 審査の4軸
チェック項目（各出力 × 4軸 で審査）：

- [ ] **① Next Action明確度**: 読了後に「まず何をすればいいか」が1文で言えるか。曖昧な結びになっていないか
- [ ] **② 動機づけ（Why）**: 読み手にとっての価値・利益が明示されているか。「なぜ協力すべきか」が伝わるか
- [ ] **③ 障壁排除**: 行動を阻む要素（不明点・手間・不安）が潰されているか。「添付が必要」→添付が存在する等
- [ ] **④ 緊急度・時間軸**: 「いつまでに」「今なぜ」が明確か。時限性がないと後回しにされる

#### 判定基準
| ランク | 基準 |
|--------|------|
| 🟢 A | 4軸すべてクリア。読めば行動が起きる |
| 🟡 B | 3軸クリア。軽微な修正で改善可能 |
| 🔴 C | 2軸以下。読んでも「で、どうすれば？」となる |

出力形式：
```
| 出力 | 想定読者 | ①Next Action | ②動機 | ③障壁 | ④緊急度 | 判定 | 改善案 |
```

### 6. 📱 プロダクト品質審査役（Product Quality Auditor）

**観点**: 実際に使われる環境で成果物が「使い物になる」か

チェック項目：
- [ ] **モバイル体験**: ターゲット（地方の活動者）はスマホユーザーが多い。375px幅でチャットUI・結果タブ・チップ選択が崩れないか
- [ ] **PDF出力品質**: 印刷して行政・企業に渡す最終成果物。テーブル崩れ・文字化け・ページ切れがないか
- [ ] **5秒テスト**: 初見ユーザーがヒーロー画面を5秒見て「何ができる」「自分が使っていい」を理解できるか
- [ ] **認知負荷**: 結果4タブの情報量が多すぎないか。タブ順は行動順になっているか
- [ ] **リピート導線**: 結果を閉じた後、別パターンで再生成したいとき迷わないか
- [ ] **アクセシビリティ**: コントラスト比・キーボード操作・スクリーンリーダー対応
- [ ] **信頼感**: 「AI生成」への不安を和らげる要素があるか

出力形式：
```
| # | 重要度 | 箇所 | 問題 | 改善案 |
```

### 7. 🚀 グロース審査役（Growth / Viral Auditor）

**観点**: ユーザーが自然にこのアプリを広めたくなる仕掛けがあるか

**原則**: 地方活動者のネットワークは「同じ悩みを持つ人」の集まり。
1人が「これ良かった」と言えば、5人に届くポテンシャルがある。

チェック項目：
- [ ] **共有導線**: 結果画面に「このツールを友人に教える」導線があるか（URLコピー・SNSシェア・LINE送信）
- [ ] **「結果が広告」効果**: 生成したPDF・SNS投稿がそのままアプリの宣伝になるか（クレジット表示等）
- [ ] **成功体験の共有性**: 「生成完了！」という達成感を他者と共有したくなるデザインか
- [ ] **リピートユース**: 「次の人」のためにもう一度使いたくなるモチベーションがあるか
- [ ] **口コミトリガー**: 「これ良かった」と言いたくなる「驚き」の瞬間があるか（生成完了時の体験）

出力形式：
```
| # | 重要度 | 箇所 | 問題 | 改善案 |
```

### 8. 全体判定の出力

6つの視点の判定をまとめる：

```
| 視点 | 判定 | 一言 |
|------|------|------|
| UX   | 🟢/🟡/🔴 + ランク | コメント |
| 設計 | 🟢/🟡/🔴 + ランク | コメント |
| UI   | 🟢/🟡/🔴 + ランク | コメント |
| 行動変容 | 🟢/🟡/🔴 + ランク | コメント |
| プロダクト品質 | 🟢/🟡/🔴 + ランク | コメント |
| グロース | 🟢/🟡/🔴 + ランク | コメント |
```

### 9. 改善タスクの優先順位付け

🔴高 の指摘を最優先で `task.md` に追加し、実装ループに入る。

優先順位ルール：
1. **🔴高 + セキュリティ** → 即時対応
2. **🔴高 + 行動変容（読んでも動けない）** → 即時対応
3. **🔴高 + UX（ユーザーが詰まる）** → 同日対応
4. **🟡中** → 次スプリント
5. **🟢低** → バックログ

---

## 実行タイミング

| タイミング | 必須/推奨 |
|-----------|-----------|
| 新機能の実装完了時 | ✅ 必須 |
| デモ前のチェック | ✅ 必須 |
| デプロイ前 | ✅ 必須 |
| リファクタリング後 | 推奨 |
| ユーザーフィードバック反映後 | 推奨 |

---

## 補足ルール

- レビュー結果はアーティファクトとして保存（`three_perspective_review.md`）
- 前回のレビュー結果と比較し、改善/悪化の追跡を行う
- 判定が全て🟢になるまで改善ループを回す必要はない。**🔴がゼロ**を目標とする
